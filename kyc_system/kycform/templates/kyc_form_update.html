{% load static %}
<!DOCTYPE html>
<html lang="ne">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ø ‡§ú‡•Ä‡§µ‡§® ‡§¨‡•Ä‡§Æ‡§æ ‡§ï‡§Æ‡•ç‡§™‡§®‡•Ä ‡§≤‡§ø‡§Æ‡§ø‡§ü‡•á‡§° | KYC Form</title>

  <!-- Bootstrap (Local) -->
  <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">

  <!-- Nepali Datepicker -->
  <link href="https://nepalidatepicker.sajanmaharjan.com.np/v5/nepali.datepicker/css/nepali.datepicker.v5.0.6.min.css"
    rel="stylesheet">

  <!-- SweetAlert2 -->
  <link href="{% static 'css/sweetalert2.min.css' %}" rel="stylesheet">

  <!-- Custom CSS -->
  <link href="{% static 'css/kyc-form.css' %}" rel="stylesheet">
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Left Sidebar -->
      <div class="col-md-3 sidebar">
        <div class="logo-section">
          <img src="{% static 'images/rjbclogo.png' %}" alt="RJBC Logo" class="logo">
        </div>

        <div class="step-indicator">
          <h6 class="step-title">KYC Form</h6>
          <p class="step-subtitle">Step <span id="currentStep">1</span> of 5</p>
        </div>

        <nav class="nav-steps">
          <a href="#" class="nav-step active" data-step="1">
            <span class="step-number">1</span>
            <span class="step-name">Personal Details</span>
          </a>
          <a href="#" class="nav-step" data-step="2">
            <span class="step-number">2</span>
            <span class="step-name">Address Details</span>
          </a>
          <a href="#" class="nav-step" data-step="3">
            <span class="step-number">3</span>
            <span class="step-name">Financial Details</span>
          </a>
          <a href="#" class="nav-step" data-step="4">
            <span class="step-number">4</span>
            <span class="step-name">Nominee Details</span>
          </a>
          <a href="#" class="nav-step" data-step="5">
            <span class="step-number">5</span>
            <span class="step-name">Additional Details</span>
          </a>
        </nav>
      </div>

      <!-- Main Content -->
      <div class="col-md-9 main-content">
        {% if rejection_message %}
        <div style="
            background:#ffe6e6;
            padding:14px;
            border-left:6px solid #cc0000;
            margin-bottom:20px;
            border-radius:4px;
            font-size:15px;
            color:#7a0000;
        ">
          <strong>Your KYC was rejected.</strong><br>
          {{ rejection_message }}
        </div>
        {% endif %}

        <div class="form-container">
          <form id="kycForm" method="POST" action="{% url 'kyc:kyc_submit' %}" enctype="multipart/form-data">
            {% csrf_token %}

            <input type="hidden" name="policy_no" id="policyField">

            <!-- Step 1: Personal Details -->
            <div class="form-step active" data-step="1">
              <h4 class="form-step-title">Personal Details</h4>

              <!-- Photo Upload -->
              <div class="photo-upload-section">
                <div class="photo-preview">
                  <img id="photoPreview" src="{% static 'images/default-avatar.png' %}" alt="Photo">
                </div>
                <div class="photo-upload-controls">
              
                  <label class="form-label">
                    Passport Size Photo <span class="text-danger">*</span>
                  </label>
                  <p class="form-text">Supports jpg, jpeg and png. 300KB max.</p>
              
                  <!-- FILE INPUT (patched) -->
                  <input type="file" id="photoUpload" name="photo" accept="image/*" data-preview="photo"
                    data-existing="{{ prefill_json.photo_url|default:'' }}" style="display:none;" required>
              
                  <!-- UPLOAD BUTTON -->
                  <button id="photoBtn" type="button" class="btn btn-outline-primary btn-sm mb-1"
                    onclick="document.getElementById('photoUpload').click()">
                    Upload
                  </button>
              
                  <!-- REMOVE BUTTON -->
                  <button type="button" class="btn btn-link btn-sm text-danger" id="removePhoto">
                    Remove
                  </button>
              
                  <!-- PREVIEW CONTAINER (patched) -->
                  <div id="photo_preview" class="mt-2">
                    {% if prefill_json.photo_url %}
                    <img src="{{ prefill_json.photo_url }}" class="uploaded-preview-img" style="max-height: 140px;">
                    {% endif %}
                  </div>
                </div>
              
              </div>

              <!-- Name Fields -->
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">First Name <span class="text-danger">*</span></label>
                  <input type="text" name="first_name" class="form-control alpha-text" required autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Middle Name</label>
                  <input type="text" name="middle_name" class="form-control alpha-text" autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Last Name <span class="text-danger">*</span></label>
                  <input type="text" name="last_name" class="form-control alpha-text" required autocomplete="off">
                </div>
              </div>

              <div class="row">
                <div class="col-md-8 mb-3">
                  <label class="form-label">‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ (‡§¶‡•á‡§µ‡§®‡§æ‡§ó‡§∞‡•Ä‡§Æ‡§æ) <span class="text-danger">*</span></label>
                  <input type="text" id="full_name_nep" name="full_name_nep" class="form-control" required
                    autocomplete="off">
                </div>
              </div>

              <!-- Personal Information -->
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Salutation</label>
                  <select name="salutation" class="form-select">
                    <option value="">Select</option>
                    <option value="Mr">Mr</option>
                    <option value="Mrs">Mrs</option>
                    <option value="Ms">Ms</option>
                    <option value="Dr">Dr</option>
                  </select>
                </div>

                <div class="col-md-4 mb-3">
                  <label class="form-label">Nationality <span class="text-danger">*</span></label>
                  <select name="nationality" class="form-select" required>
                    <option value="Nepalese" selected>Nepalese</option>
                    <option value="Indian">Indian</option>
                    <option value="Chinese">Chinese</option>
                    <option value="Others">Other</option>
                  </select>
                </div>

                <div class="col-md-4 mb-3">
                  <label class="form-label">Gender <span class="text-danger">*</span></label>
                  <div class="gender-options">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" id="male" name="gender" value="Male" required>
                      <label class="form-check-label" for="male">Male</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" id="female" type="radio" name="gender" value="Female">
                      <label class="form-check-label" for="female">Female</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" id="other-gender" type="radio" name="gender" value="Other">
                      <label class="form-check-label" for="other-gender">Other</label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- DOB -->
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Date of Birth (BS) <span class="text-danger">*</span></label>
                  <input type="text" id="dob_bs" name="dob_bs" class="form-control" placeholder="YYYY/MM/DD" required
                    autocomplete="off">
                </div>
                <div class="col-md-4 mb-3" onclick="document.getElementById('dob_ad').showPicker()">
                  <label class="form-label">Date of Birth (AD) <span class="text-danger">*</span></label>
                  <input type="date" id="dob_ad" name="dob_ad" class="form-control" placeholder="YYYY-MM-DD" required
                    autocomplete="off">
                </div>

                <div class="col-md-4 mb-3">
                  <label class="form-label">Marital Status <span class="text-danger">*</span></label>
                  <div class="marital-options">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" id="Married" type="radio" name="marital_status" value="Married"
                        required>
                      <label class="form-check-label" for="Married">Married</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" id="Unmarried" type="radio" name="marital_status"
                        value="Unmarried">
                      <label class="form-check-label" for="Unmarried">Unmarried</label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Contact -->
              <div class="row mb-4">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Email Address <span class="text-danger">*</span></label>
                  <input type="email" name="email" class="form-control" required autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Mobile No. <span class="text-danger">*</span></label>
                  <input type="text" id="mobile" name="mobile" class="form-control" required autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Telephone No. </label>
                  <input type="text" name="telephone" class="form-control" autocomplete="off">
                </div>
              </div>

              <h4 class="form-step-title">Documents</h4>

              <!-- Citizenship number & Issued Dates -->
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Citizenship No.<span class="text-danger">*</span></label>
                  <input type="text" name="citizenship_no" class="form-control" required autocomplete="off">
                </div>

                <div class="col-md-4 mb-3">
                  <label class="form-label">Document Issued Date (BS) <span class="text-danger">*</span></label>
                  <input type="text" id="citizen_bs" name="citizen_bs" class="form-control"
                    placeholder="YYYY/MM/DD" required autocomplete="off">
                </div>

                <div class="col-md-4 mb-3" onclick="document.getElementById('citizen_ad').showPicker()">
                  <label class="form-label">Document Issued Date (AD) <span class="text-danger">*</span></label>
                  <input type="date" id="citizen_ad" name="citizen_ad" class="form-control"
                    placeholder="YYYY-MM-DD" required autocomplete="off">
                </div>
              </div>

              <div class="row mb-4">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Document Issued Place <span class="text-danger">*</span></label>
                  <input type="text" name="citizenship_place" class="form-control alpha-text" required
                    autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Passport No.</label>
                  <input type="text" name="passport_no" class="form-control" autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">National Identity Card No.</label>
                  <input type="text" name="nid_no" class="form-control" autocomplete="off">
                </div>
              </div>

              <!-- Document Uploads Citizenship -->
              <div class="row mb-4">
                <div class="col-md-6">
                  <div class="document-upload" id="citizenship_front">
                    <div class="transparent-dark-div">
                      <div class="upload-icon">üìÑ</div>
                      <label class="form-label text-white">Citizenship Front <span class="text-danger">*</span></label>
                      <p class="form-text text-white-50">Supports jpg, jpeg and png. 500KB max.</p>
                      <input type="file" data-filename="citizenshipFrontFileName" id="citizenshipFrontUpload"
                        name="citizenship-front" accept="image/*,application/pdf" data-preview="citizenship_front"
                        style="display:none;" required>
                      <button type="button" class="btn btn-outline-secondary btn-sm"
                        onclick="document.getElementById('citizenshipFrontUpload').click()">
                        <span class="upload-icon-btn">‚¨á</span>
                      </button>
                      <button type="button" class="btn btn-outline-danger btn-sm remove-btn" style="display:none;">
                        <span class="fw-bolder">‚úï</span>
                      </button>
                      <span class="file-name" id="citizenshipFrontFileName">Citizenship Front</span>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="document-upload" id="citizenship_back">
                    <div class="transparent-dark-div">
                      <div class="upload-icon">üìÑ</div>
                      <label class="form-label text-white">Citizenship Back <span class="text-danger">*</span></label>
                      <p class="form-text text-white-50">Supports jpg, jpeg and png. 500KB max.</p>
                      <input type="file" data-filename="citizenshipBackFileName" id="citizenshipBackUpload"
                        name="citizenship-back" accept="image/*,application/pdf" data-preview="citizenship_back"
                        style="display:none;" required>
                      <button type="button" class="btn btn-outline-secondary btn-sm"
                        onclick="document.getElementById('citizenshipBackUpload').click()">
                        <span class="upload-icon-btn">‚¨á</span>
                      </button>
                      <button type="button" class="btn btn-outline-danger btn-sm remove-btn" style="display:none;">
                        <span class="fw-bolder">‚úï</span>
                      </button>
                      <span class="file-name" id="citizenshipBackFileName">Citizenship Back</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Document Uploads NID & Signature-->
              <div class="row mb-4">
                <div class="col-md-6">
                  <div class="document-upload" id="Nid_doc">
                    <div class="transparent-dark-div">
                      <div class="upload-icon">üìÑ</div>
                      <label class="form-label text-white">National Identity Card (optional)</label>
                      <p class="form-text text-white-50">Supports jpg, jpeg and png. 500KB max.</p>
                      <input type="file" data-filename="nidFileName" id="NidUpload" name="nid"
                        accept="image/*,application/pdf" data-preview="Nid_doc" style="display:none;">
                      <button type="button" class="btn btn-outline-secondary btn-sm"
                        onclick="document.getElementById('NidUpload').click()">
                        <span class="upload-icon-btn">‚¨á</span>
                      </button>
                      <button type="button" class="btn btn-outline-danger btn-sm remove-btn" style="display:none;">
                        <span class="fw-bolder">‚úï</span>
                      </button>
                      <span class="file-name" id="nidFileName">Rastriya Parichaya Patra</span>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="document-upload" id="signature">
                    <div class="transparent-dark-div">
                      <div class="upload-icon">üìÑ</div>
                      <label class="form-label text-white">Signature <span class="text-danger">*</span></label>
                      <p class="form-text text-white-50">Supports jpg, jpeg and png. 500KB max.</p>
                      <input type="file" data-filename="signatureFileName" id="signatureUpload" name="signature"
                        accept="image/*,application/pdf" data-preview="signature" style="display:none;" required>
                      <button type="button" class="btn btn-outline-secondary btn-sm"
                        onclick="document.getElementById('signatureUpload').click()">
                        <span class="upload-icon-btn">‚¨á</span>
                      </button>
                      <button type="button" class="btn btn-outline-danger btn-sm remove-btn" style="display:none;">
                        <span class="fw-bolder">‚úï</span>
                      </button>
                      <span class="file-name" id="signatureFileName">Your Signature</span>
                    </div>
                  </div>
                </div>
              </div>

              <h4 class="form-step-title">Family Details</h4>
              <!-- Married Details -->
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Spouse Name <span class="text-danger">*</span></label>
                  <input type="text" id="spouse_name" name="spouse_name" class="form-control alpha-text"
                    autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Grand Father's Name <span class="text-danger">*</span></label>
                  <input type="text" name="grand_father_name" class="form-control alpha-text" required
                    autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Proposer's Name <span style="font-size: 12px; color: grey;">(In case of a
                      child)</span> </label>
                  <input type="text" name="proposer_name" class="form-control alpha-text" autocomplete="off">
                </div>
              </div>

              <!-- Close Family -->
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Father's Name <span class="text-danger">*</span></label>
                  <input type="text" name="father_name" class="form-control alpha-text" required autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Mother's Name <span class="text-danger">*</span></label>
                  <input type="text" name="mother_name" class="form-control alpha-text" required autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Father in Law's Name</label>
                  <input type="text" name="father_in_law_name" class="form-control alpha-text" autocomplete="off">
                </div>
              </div>

              <!-- Close Family 2 -->
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Son's Name</label>
                  <input type="text" name="son_name" class="form-control alpha-text" autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Daughter's Name</label>
                  <input type="text" name="daughter_name" class="form-control alpha-text" autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Daughter in Law's Name</label>
                  <input type="text" name="daughter_in_law_name" class="form-control alpha-text" autocomplete="off">
                </div>
              </div>
            </div>

            <!-- Step 2: Address Details -->
            <div class="form-step" data-step="2">
              <h4 class="form-step-title">Address Details</h4>

              <h6 class="section-subtitle">‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§†‡•á‡§ó‡§æ‡§®‡§æ (Permanent Address)</h6>
              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">Province <span class="text-danger">*</span></label>
                  <select id="perm_province" name="perm_province" class="form-select" required>
                    <option value="">Select Province</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">District <span class="text-danger">*</span></label>
                  <select id="perm_district" name="perm_district" class="form-select" required>
                    <option value="">Select District</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Municipality <span class="text-danger">*</span></label>
                  <select id="perm_muni" name="perm_municipality" class="form-select" required>
                    <option value="">Select Municipality</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Ward <span class="text-danger">*</span></label>
                  <input type="number" id="perm_ward" name="perm_ward" class="form-control" required autocomplete="off">
                </div>
              </div>

              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">Address <span class="text-danger">*</span></label>
                  <input type="text" id="perm_address" name="perm_address" class="form-control" required
                    autocomplete="off">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">House No.</label>
                  <input type="text" id="perm_house_number" name="perm_house_number" class="form-control"
                    autocomplete="off">
                </div>
              </div>

              <h6 class="section-subtitle mt-4">‡§Ö‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§†‡•á‡§ó‡§æ‡§®‡§æ (Temporary Address)</h6>
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="sameAddress">
                <label class="form-check-label" for="sameAddress">
                  Same as Permanent Address
                </label>
              </div>
              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">Province <span class="text-danger">*</span></label>
                  <select id="temp_province" name="temp_province" class="form-select" required>
                    <option value="">Select Province</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">District <span class="text-danger">*</span></label>
                  <select id="temp_district" name="temp_district" class="form-select" required>
                    <option value="">Select District</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Municipality <span class="text-danger">*</span></label>
                  <select id="temp_muni" name="temp_municipality" class="form-select" required>
                    <option value="">Select Municipality</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Ward <span class="text-danger">*</span></label>
                  <input id="temp_ward" type="number" name="temp_ward" class="form-control" required autocomplete="off">
                </div>
              </div>
              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">Address <span class="text-danger">*</span></label>
                  <input id="temp_address" type="text" name="temp_address" class="form-control" required
                    autocomplete="off">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">House No.</label>
                  <input type="text" id="temp_house_number" name="temp_house_number" class="form-control"
                    autocomplete="off">
                </div>
              </div>
            </div>

            <!-- Step 3: Financial Details -->
            <div class="form-step" data-step="3">
              <h4 class="form-step-title">Financial Details</h4>

              <h6 class="section-subtitle mt-4">Bank Details</h6>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Bank Name <span class="text-danger">*</span></label>
                  <select name="bank_name" id="bankSelect" class="form-select" required autocomplete="off">
                    <option value="">Select Bank</option>
                    <!-- Options will be populated dynamically -->
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Branch <span class="text-danger">*</span></label>
                  <input type="text" name="branch_name" class="form-control" required autocomplete="off">
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Account Number <span class="text-danger">*</span></label>
                  <input type="text" name="account_number" class="form-control" required autocomplete="off">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Account Type <span class="text-danger">*</span></label>
                  <select name="account_type" class="form-select" required>
                    <option value="">Select</option>
                    <option value="Saving">Saving</option>
                    <option value="Current">Current</option>
                  </select>
                </div>
              </div>

              <h6 class="section-subtitle mt-4">Professional Details</h6>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Occupation <span class="text-danger">*</span></label>
                  <select name="occupation" id="occupation" class="form-select" required>
                    <option value="">Select Profession</option>
                    <!-- Options will be populated dynamically -->
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Occupation Description <span class="text-danger">*</span></label>
                  <input type="text" id="occupation_description" name="occupation_description"
                    class="form-control">
                </div>
                <div class=" col-md-4 mb-3">
                  <label class="form-label">Income Mode <span class="text-danger">*</span></label>
                  <select name="income_mode" id="income_mode" class="form-select" required>
                    <option value="">Select Mode</option>
                    <option value="Yearly">Yearly</option>
                    <option value="Monthly">Monthly</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Annual Income (Rs.) <span class="text-danger">*</span></label>
                  <input type="number" id="annual_income" name="annual_income" class="form-control" required
                    autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Source of Income <span class="text-danger">*</span></label>
                  <input type="text" id="income_source" name="income_source" class="form-control" required
                    autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">PAN number <span class="text-danger">*</span></label>
                  <input type="text" id="pan_number" name="pan_number" class="form-control" required
                    autocomplete="off">
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Qualification<span class="text-danger">*</span></label>
                  <select name="qualification" id="qualification" class="form-select" required>
                    <option value="">Select Qualification</option>
                    <option value="Bachelor">Bachelor</option>
                    <option value="SLC">SLC</option>
                    <option value="Intermediate">Intermediate</option>
                    <option value="Masters">Masters</option>
                    <option value="PHD">PHD</option>
                    <option value="SEE">SEE</option>
                    <option value="Below SLC">Below SLC</option>
                    <option value="Illiterate">Illiterate</option>
                    <option value="Literate">Literate</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Employer Name </label>
                  <input type="text" name="employer_name" class="form-control" autocomplete="off">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Office Address</label>
                  <input type="text" name="office_address" class="form-control" autocomplete="off">
                </div>
              </div>
            </div>

            <!-- Step 4: Nominee Details -->
            <div class="form-step" data-step="4">
              <h4 class="form-step-title">Nominee Details</h4>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Nominee Name <span class="text-danger">*</span></label>
                  <input type="text" name="nominee_name" class="form-control" required autocomplete="off">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Relationship with Nominee <span class="text-danger">*</span></label>
                  <select name="nominee_relation" class="form-select" required>
                    <option value="">Select</option>
                    <option value="Spouse">Spouse</option>
                    <option value="Father">Father</option>
                    <option value="Mother">Mother</option>
                    <option value="Son">Son</option>
                    <option value="Daughter">Daughter</option>
                    <option value="Brother">Brother</option>
                    <option value="Sister">Sister</option>
                    <option value="In-Laws">In-Laws</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">Nominee Date of Birth (BS) <span class="text-danger">*</span></label>
                  <input type="text" id="nominee_dob_bs" name="nominee_dob_bs" class="form-control"
                    placeholder="YYYY/MM/DD" required >
                </div>
                <div class="col-md-3 mb-3" onclick="document.getElementById('nominee_dob_ad').showPicker()">
                  <label class="form-label">Nominee Date of Birth (AD) <span class="text-danger">*</span></label>
                  <input type="date" id="nominee_dob_ad" name="nominee_dob_ad" class="form-control"
                    placeholder="YYYY-MM-DD" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Nominee Contact Number <span class="text-danger">*</span></label>
                  <input type="tel" name="nominee_contact" class="form-control" required autocomplete="off">
                </div>
              </div>

              <h6 class="section-subtitle mt-4">In Case of Minor</h6>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Guardian Name</label>
                  <input type="text" name="guardian_name" class="form-control" autocomplete="off">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Guardian Relationship</label>
                  <input type="text" name="guardian_relation" class="form-control" autocomplete="off">
                </div>
              </div>
            </div>

            <!-- Step 5: Additional Details -->
            <div class="form-step" data-step="5">
              <h4 class="form-step-title">Additional Details</h4>

              <!-- PEP and AML Declarations -->
              <div class="declaration-section mb-4">
                <h6 class="section-subtitle">Declaration Questions</h6>

                <div class="declaration-question mb-4">
                  <label class="form-label fw-bold">
                    Are you a Politically Exposed Person (PEP)?
                    <span class="text-danger">*</span>
                  </label>
                  <p class="form-text text-muted small mb-2">
                    ‡§ï‡•á ‡§§‡§™‡§æ‡§à‡§Ç ‡§∞‡§æ‡§ú‡§®‡•Ä‡§§‡§ø‡§ï ‡§∞‡•Ç‡§™‡§Æ‡§æ ‡§â‡§ú‡§æ‡§ó‡§∞ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§π‡•Å‡§®‡•Å‡§π‡•Å‡§®‡•ç‡§õ? (PEP includes current or former senior government
                    officials, political party leaders, or their close associates)
                  </p>
                  <div class="declaration-options">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="is_pep" id="pep_yes" value="yes" required>
                      <label class="form-check-label" for="pep_yes">
                        <span class="option-text">Yes / ‡§π‡•ã</span>
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="is_pep" id="pep_no" value="no">
                      <label class="form-check-label" for="pep_no">
                        <span class="option-text">No / ‡§π‡•ã‡§á‡§®</span>
                      </label>
                    </div>
                  </div>
                </div>

                <div class="declaration-question mb-4">
                  <label class="form-label fw-bold">
                    Have you ever been involved in Anti-Money Laundering (AML) related crimes?
                    <span class="text-danger">*</span>
                  </label>
                  <p class="form-text text-muted small mb-2">
                    ‡§ï‡•á ‡§§‡§™‡§æ‡§à‡§Ç ‡§ï‡§π‡§ø‡§≤‡•ç‡§Ø‡•à ‡§Æ‡§®‡•Ä ‡§≤‡§æ‡§®‡•ç‡§°‡•ç‡§∞‡§ø‡§ô ‡§µ‡§ø‡§∞‡•ã‡§ß‡•Ä (AML) ‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡§ø‡§§ ‡§Ö‡§™‡§∞‡§æ‡§ß‡§Æ‡§æ ‡§∏‡§Ç‡§≤‡§ó‡•ç‡§® ‡§π‡•Å‡§®‡•Å‡§≠‡§è‡§ï‡•ã ‡§õ?
                  </p>
                  <div class="declaration-options">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="is_aml" id="aml_yes" value="yes" required>
                      <label class="form-check-label" for="aml_yes">
                        <span class="option-text">Yes / ‡§π‡•ã</span>
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="is_aml" id="aml_no" value="no">
                      <label class="form-check-label" for="aml_no">
                        <span class="option-text">No / ‡§π‡•ã‡§á‡§®</span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Additional Documents Section -->
              <div class="additional-documents-section">
                <h6 class="section-subtitle">Additional Documents (Optional)</h6>
                <p class="form-text text-muted small mb-3">
                  You can attach up to 5 additional documents (e.g., passport, driving license, bank statement, etc.)
                </p>

                <div id="additionalDocsContainer">
                  <!-- First document field (always visible) -->
                  <div class="additional-doc-item" data-doc-index="1">
                    <div class="row align-items-end mb-3">
                      <div class="col-md-6">
                        <label class="form-label">Document Name</label>
                        <input type="text" name="additional_doc_name" class="form-control" autocomplete="off"
                          placeholder="e.g., Passport, License, etc.">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Attach Document</label>
                        <div class="document-upload-inline" id="additionalDoc1Container">
                          <input type="file" id="additionalDoc1Upload" name="additional_docs"
                            accept="image/*,application/pdf" style="display:none;">
                          <button type="button" class="btn btn-outline-secondary btn-sm"
                            onclick="document.getElementById('additionalDoc1Upload').click()">
                            <span class="upload-icon-btn">üìé</span> Choose File
                          </button>
                          <span class="file-name-inline" id="additionalDoc1FileName">No file chosen</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Add More Button -->
                <button type="button" class="btn btn-outline-success btn-sm" id="addMoreDocBtn">
                  <span>‚ûï</span> Add Another Document
                </button>
                <span class="text-muted small ms-2" id="docCounter">(1/5 documents)</span>
              </div>

              <!-- Declaration -->
              <h6 class="section-subtitle">‡§ò‡•ã‡§∑‡§£‡§æ / Declaration</h6>
              <div class="declaration-box">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="declaration" name="declaration" required
                    autocomplete="off">
                  <label class="form-check-label" for="declaration">
                    <strong>‡§ï‡•á ‡§§‡§™‡§æ‡§à‡§Ç‡§≤‡•á ‡§¶‡§ø‡§è‡§ï‡•ã ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡§§‡•ç‡§Ø ‡§∞ ‡§†‡•ç‡§Ø‡§æ‡§ï‡•ç‡§ï‡•à ‡§π‡•ã?</strong><br>
                    I hereby declare that all the information provided above is true and accurate to the best of my
                    knowledge.
                  </label>
                </div>
              </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="form-navigation d-flex gap-2">
              <button type="button" class="btn btn-outline-secondary" id="prevBtn" style="display:none;">
                Previous
              </button>
            
              <button type="button" class="btn btn-dark" id="saveBtn">
                Save
              </button>
            
              <button type="button" class="btn btn-warning" id="saveContinueBtn">
                Save & Continue
              </button>
            
              <button type="button" class="btn btn-primary" id="nextBtn">
                Continue
              </button>
            
              <button type="submit" class="btn btn-success" id="submitBtn" style="display:none;">
                ‡§™‡•á‡§∂ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç / Submit
              </button>
            </div>

          </form>
        </div>
      </div>

      <footer class="form-footer">
        <p>¬© Rastriya Jeeewan Beema Company Limited</p>
      </footer>
    </div>
  </div>

 <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
<script src="{% static 'js/nepali.datepicker.v5.0.6.min.js' %}"></script>
<script src="{% static 'js/nepalify.production.min.js' %}"></script>
<script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'js/sweetalert2.all.min.js' %}"></script>
<script src="{% static 'js/sweetalert-messages.js' %}"></script>

<!-- Nepali core converter (must load BEFORE date-conversion.js) -->
<script src="{% static 'js/nepaliFunctions.js' %}"></script>

<!-- Document upload -->
<script src="{% static 'js/docs-upload.js' %}"></script>

<!-- Main UI logic -->
<script src="{% static 'js/kyc-form.js' %}"></script>

<!-- IMPORTANT: load LAST so it overrides everything -->
<script src="{% static 'js/date-conversion.js' %}"></script>
<!-- <script src="{% static 'js/date-conversion.js' %}?v=777"></script> -->
<script src="{% static 'kycform/js/occupations.js' %}"></script>
  <script>
    // Get policy number from URL
    const params = new URLSearchParams(window.location.search);
    const policy = params.get("policy_no");
    if (policy) {
      document.getElementById("policyField").value = policy;
    }

    // "Same as Permanent" checkbox copy
    document.getElementById('sameAddress')?.addEventListener('change', function(e) {
      if (this.checked) {
        document.getElementById('temp_province').value = document.getElementById('perm_province').value;
        document.getElementById('temp_district').value = document.getElementById('perm_district').value;
        document.getElementById('temp_muni').value = document.getElementById('perm_muni').value;
        document.getElementById('temp_ward').value = document.getElementById('perm_ward').value;
        document.getElementById('temp_address').value = document.getElementById('perm_address').value;
        document.getElementById('temp_house_number').value = document.getElementById('perm_house_number').value;
      }
    });

    // small helper to show file names when user picks a file (optional)
    function bindFileName(inputId, nameSpanId) {
      const inp = document.getElementById(inputId);
      const span = document.getElementById(nameSpanId);
      if (!inp || !span) return;
      inp.addEventListener('change', () => {
        span.textContent = inp.files && inp.files.length ? inp.files[0].name : 'No file chosen';
      });
    }
    bindFileName('additionalDoc1Upload', 'additionalDoc1FileName');
    bindFileName('citizenshipFrontUpload', 'citizenshipFrontFileName');
    bindFileName('citizenshipBackUpload', 'citizenshipBackFileName');
    bindFileName('NidUpload', 'nidFileName');
    bindFileName('signatureUpload', 'signatureFileName');
  </script>

  <script>
    window.prefill_data = JSON.parse(`{{ prefill_json|escapejs }}`);
</script>


</body>

</html>
