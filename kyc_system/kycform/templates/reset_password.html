{% load static %}
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Reset Password | RJBCL</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- COMMON CSS for forgot + reset -->
<link rel="stylesheet" href="{% static 'css/forgot_password.css' %}">
<link rel="stylesheet" href="{% static 'css/popup.css' %}">
</head>

<body>

<div class="wrap">

  <!-- LEFT AREA -->
  <div class="left">
      <img src="{% static 'images/rjbclogo.png' %}" class="logo-fill" alt="RJBC Logo">
  </div>

  <!-- RIGHT AREA -->
  <div class="right">

      <div class="header-title text-center">Reset Password</div>

      {% if messages %}
        {% for m in messages %}
          <div class="d-none js-reset-msg"
               data-tags="{{ m.tags }}"
               data-text="{{ m|escapejs }}"></div>
        {% endfor %}
      {% endif %}

      <form method="POST" autocomplete="off">
        {% csrf_token %}

        <!-- Hidden values -->
        <input type="hidden" name="type" value="{{ user_type }}">
        <input type="hidden" name="identifier" value="{{ identifier }}">

        <!-- Autofill blockers -->
        <input type="text" style="display:none" autocomplete="off">
        <input type="password" style="display:none" autocomplete="new-password">

        <label class="form-label fw-semibold">New Password</label>
        <input type="password"
               name="new_password"
               class="form-control mb-3"
               autocomplete="new-password"
               required>

        <label class="form-label fw-semibold">Confirm Password</label>
        <input type="password"
               name="confirm_password"
               class="form-control mb-4"
               autocomplete="new-password"
               required>

        <button class="btn-green mb-2">Update Password</button>

        {% if user_type == "agent" %}
            <a href="/auth/agent/?tab=agent"
               class="text-center d-block mt-2 login-link">
               Back to Login
            </a>
        {% else %}
            <a href="/auth/policy/?tab=policy"
               class="text-center d-block mt-2 login-link">
               Back to Login
            </a>
        {% endif %}
      </form>

  </div>
</div>

<!-- POPUP -->
<div id="popup" class="popup-overlay">
  <div class="popup-box">
      <div id="popupIcon"></div>
      <div id="popupTitle" class="fw-bold mb-2"></div>
      <div id="popupMsg" class="mb-3"></div>
      <button id="popupOk" class="btn-green">OK</button>
  </div>
</div>

<!-- COMMON scripts -->
<script src="{% static 'js/popup.js' %}"></script>
<script src="{% static 'js/forgot_password.js' %}"></script>

<script>
// Run popup trigger (same logic in forgot_password.js)
const msgNode = document.querySelector('.js-reset-msg');
if(msgNode){
    showPopup(msgNode.dataset.tags, msgNode.dataset.text);
}
</script>

</body>
</html>
