{% load static %}
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RJBC Login</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
  :root {
      --green:#00c06f;
      --blue:#0a1d56;
  }

  body {
      background:linear-gradient(180deg,#06b36a 0,#00a45a 100%);
      height:100vh;
      margin:0;
      display:flex;
      justify-content:center;
      align-items:center;
      font-family:'Segoe UI', sans-serif;
  }

  /* MAIN LOGIN CARD */
  .login-card {
      width:100%;
      max-width:820px;
      background:#fff;
      border-radius:16px;
      display:flex;
      overflow:hidden;
      box-shadow:0 15px 40px rgba(0,0,0,0.18);
      height:450px;
  }

  /* LEFT TABS PANEL */
  .left-tabs {
      width:240px;
      padding:25px 18px;
      background:#f9fafb;
      border-right:1px solid #e2e2e2;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:25px;
  }

  .left-tabs img {
      width:140px;
      margin-bottom:5px;
  }

  .tab-btn {
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px 14px;
      width:100%;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      color:#333;
      transition:0.25s;
  }

  .tab-btn.active {
      background:var(--green);
      color:#fff;
  }

  .tab-btn i { font-size:20px; }

  /* RIGHT FORM AREA */
  .right-form {
      flex:1;
      padding:40px 55px;
  }

  .login-title {
      font-size:23px;
      font-weight:700;
      color:var(--blue);
      margin-bottom:18px;
  }

  .form-control {
      border-radius:10px;
      padding:0.85rem;
      font-size:15px;
  }

  .btn-green {
      background:var(--green);
      color:#fff;
      width:100%;
      border:none;
      border-radius:10px;
      padding:12px;
      font-weight:700;
  }

  .small-link {
      text-align:center;
      margin-top:10px;
      font-size:0.92rem;
  }

  /* POPUP */
  .popup-overlay {
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.45);
      z-index:2000;
  }

  .popup-box {
      width:360px;
      background:#fff;
      border-radius:14px;
      padding:26px;
      text-align:center;
      box-shadow:0 14px 38px rgba(0,0,0,0.28);
  }
</style>

</head>
<body>

<div class="login-card">

    <!-- LEFT SIDE TABS -->
    <div class="left-tabs">
        <img src="{% static 'images/rjbclogo.png' %}" alt="RJBC Logo">

        <div id="tabPolicy" class="tab-btn active">
            <i class="bi bi-person-circle"></i> Policyholder Login
        </div>

        <div id="tabAgent" class="tab-btn">
            <i class="bi bi-person-badge"></i> Agent Login
        </div>
    </div>

    <!-- RIGHT SIDE FORMS -->
    <div class="right-form">

        <!-- Logo above form -->
        <div class="text-center mb-4">
            <img src="{% static 'images/rjbclogo.png' %}" style="width:260px;">
        </div>

        {% if messages %}
            {% for msg in messages %}
            <div class="d-none js-msg" data-tags="{{ msg.tags }}" data-text="{{ msg|escapejs }}"></div>
            {% endfor %}
        {% endif %}

        <!-- POLICY LOGIN FORM -->
        <form id="policyForm" method="POST" action="{% url 'kyc:policy_login' %}">
            {% csrf_token %}
            <div class="login-title text-center">Policyholder Login</div>

            <input class="form-control mb-3" name="policy_no" placeholder="Policy Number" required>
            <input class="form-control mb-4" name="password" type="password" placeholder="Password (YYYYMMDD)" required>

            <button class="btn-green">Login</button>

            <div class="small-link">
                New User? <a href="{% url 'kyc:policy_register' %}">Register your Policy No.</a>
            </div>
        </form>

        <!-- AGENT LOGIN FORM -->
        <form id="agentForm" method="POST" action="{% url 'kyc:agent_login' %}" style="display:none;">
            {% csrf_token %}

            <div class="login-title text-center">Agent Login</div>

            <input class="form-control mb-3" name="agent_code" placeholder="Agent Code" required>
            <input class="form-control mb-4" name="password" type="password" placeholder="Password" required>

            <button class="btn-green">Login</button>

            <div class="small-link">
                New Agent? <a href="{% url 'kyc:agent_register' %}">Register your Agent Code</a>
            </div>
        </form>

    </div>
</div>

<!-- POPUP -->
<div id="popup" class="popup-overlay">
    <div class="popup-box">
        <div id="popupIcon"></div>
        <div id="popupTitle" class="popup-title"></div>
        <div id="popupMsg" class="popup-msg"></div>
        <button id="popupOk" class="popup-ok btn-green">OK</button>
    </div>
</div>

<script>
// Tab switching
const tabPolicy=document.getElementById("tabPolicy");
const tabAgent=document.getElementById("tabAgent");
const policyForm=document.getElementById("policyForm");
const agentForm=document.getElementById("agentForm");

tabPolicy.onclick=()=>{
    tabPolicy.classList.add("active");
    tabAgent.classList.remove("active");
    policyForm.style.display="block";
    agentForm.style.display="none";
};

tabAgent.onclick=()=>{
    tabAgent.classList.add("active");
    tabPolicy.classList.remove("active");
    agentForm.style.display="block";
    policyForm.style.display="none";
};

// Auto-select tab
{% if active_tab == "agent" %}
tabAgent.click();
{% endif %}

// POPUP HANDLING
const popup = document.getElementById("popup");
const popupIcon = document.getElementById("popupIcon");
const popupTitle = document.getElementById("popupTitle");
const popupMsg = document.getElementById("popupMsg");
const popupOk = document.getElementById("popupOk");

const m=document.querySelector(".js-msg");
if(m){
    popup.style.display="flex";
    popupMsg.textContent=m.dataset.text;

    if(m.dataset.tags.includes("success")){
        popupTitle.textContent="Success";
        popupIcon.innerHTML = `<i class="bi bi-check-circle-fill" style="font-size:32px;color:#16a34a"></i>`;
        popupOk.onclick = () => window.location.reload();
    } else {
        popupTitle.textContent="Error";
        popupIcon.innerHTML = `<i class="bi bi-x-circle-fill" style="font-size:32px;color:#dc3545"></i>`;
        popupOk.onclick = () => popup.style.display="none";
    }
}
</script>

</body>
</html>
