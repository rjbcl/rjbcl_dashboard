{% load static %}
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RJBC Login</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
:root {
    --green:#00c06f;
    --blue:#0a1d56;
}

body {
    background:linear-gradient(180deg,#06b36a 0,#00a45a 100%);
    height:100vh;
    margin:0;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:'Segoe UI', sans-serif;
}

/* MAIN LOGIN CARD */
.login-card {
    width:100%;
    max-width:920px;
    background:#fff;
    border-radius:16px;
    display:flex;
    overflow:hidden;
    box-shadow:0 15px 40px rgba(0,0,0,0.18);
    height:500px;
}

/* LEFT PANEL */
.left-tabs {
    width:260px;
    padding:30px 18px;
    background:#f9fafb;
    border-right:1px solid #e2e2e2;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:30px;
}

/* LOGO */
.left-tabs img {
    width:220px;
    height:auto;
    object-fit:contain;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.15));
    margin-top:10px;
    margin-bottom:20px;
}

/* TABS */
.tab-btn {
    display:flex;
    align-items:center;
    gap:12px;
    padding:12px 14px;
    width:100%;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
    color:#333;
    transition:0.25s;
}

.tab-btn.active {
    background:var(--green);
    color:#fff;
}

.tab-btn i { font-size:20px; }

/* RIGHT FORM AREA */
.right-form {
    flex:1;
    padding:40px 55px;
}

.login-title {
    font-size:24px;
    font-weight:700;
    color:var(--blue);
    margin-bottom:22px;
}

/* HEADER LOGO */
.header-logo {
    display:flex;
    justify-content:center;
    margin-top:-10px;
    margin-bottom:10px;
}

.header-logo img {
    width:360px;
    max-width:95%;
    height:auto;
    object-fit:contain;
    filter: drop-shadow(0 1px 3px rgba(0,0,0,0.20));
}

/* FORM */
.form-control {
    border-radius:10px;
    padding:0.85rem;
    font-size:15px;
}

.btn-green {
    background:var(--green);
    color:#fff;
    width:100%;
    border:none;
    border-radius:10px;
    padding:12px;
    font-weight:700;
}

.small-link {
    text-align:center;
    margin-top:10px;
    font-size:0.92rem;
}

/* POPUP */
.popup-overlay {
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,0.45);
    z-index:2000;
}

.popup-box {
    width:360px;
    background:#fff;
    border-radius:14px;
    padding:26px;
    text-align:center;
    box-shadow:0 14px 38px rgba(0,0,0,0.28);
}
</style>
</head>
<body>

<div class="login-card">

    <!-- LEFT NAV -->
    <div class="left-tabs">
        <img src="{% static 'images/rjbclogo.png' %}" alt="RJBC Logo">

        <div id="tabPolicy" class="tab-btn active" style="color:var(--blue);">
            <i class="bi bi-person-circle"></i> Policy Holder Login
        </div>

        <div id="tabAgent" class="tab-btn" style="color:var(--blue);">
            <i class="bi bi-person-badge"></i> Agent Login
        </div>

        <!-- ADMIN IS NOW SEPARATE PAGE, NO TAB NEEDED -->
    </div>

    <!-- RIGHT FORMS -->
    <div class="right-form">

        <div class="header-logo">
            <img src="{% static 'images/rjbclogo.png' %}">
        </div>

        {% if messages %}
            {% for msg in messages %}
            <div class="d-none js-msg" data-tags="{{ msg.tags }}" data-text="{{ msg|escapejs }}"></div>
            {% endfor %}
        {% endif %}

        <!-- POLICY LOGIN -->
        <form id="policyForm" method="POST" action="{% url 'kyc:policy_login' %}" autocomplete="off">
        
            {% csrf_token %}
        
            <!-- Fake hidden fields to disable Chrome autofill -->
            <input type="text" style="display:none" autocomplete="off">
            <input type="password" style="display:none" autocomplete="new-password">
        
            <div class="login-title text-center">Policy Holder Login</div>
        
            <input class="form-control mb-3" name="policy_no" placeholder="Policy Number" autocomplete="off" required>
        
            <input class="form-control mb-4" name="password" type="password" placeholder="Password" autocomplete="new-password"
                required>
        
            <button class="btn-green">Login</button>
        
            <div class="small-link mt-2">
                <a href="/forgot-password/?type=policy" style="color:#0a58ca;">Forgot Password?</a>
            </div>
        
            <div class="small-link">
                New User? <a href="{% url 'kyc:policy_register' %}">Register your Policy No.</a>
            </div>
        
            <!-- ADMIN LOGIN LINK -->
            <div class="small-link mt-3">
                <a href="{% url 'kyc:admin_login' %}" style="font-weight:700;color:#0a1d56;">
                    Admin Login
                </a>
            </div>
        </form>
        
        
        <!-- AGENT LOGIN -->
        <form id="agentForm" method="POST" action="{% url 'kyc:agent_login' %}" style="display:none;" autocomplete="off">
        
            {% csrf_token %}
        
            <!-- Fake hidden fields to disable Chrome autofill -->
            <input type="text" style="display:none" autocomplete="off">
            <input type="password" style="display:none" autocomplete="new-password">
        
            <div class="login-title text-center">Agent Login</div>
        
            <input class="form-control mb-3" name="agent_code" placeholder="Agent Code" autocomplete="off" required>
        
            <input class="form-control mb-4" name="password" type="password" placeholder="Password" autocomplete="new-password"
                required>
        
            <button class="btn-green">Login</button>
        
            <div class="small-link mt-2">
                <a href="/forgot-password/?type=agent" style="color:#0a58ca;">Forgot Password?</a>
            </div>
        
            <div class="small-link">
                New Agent? <a href="{% url 'kyc:agent_register' %}">Register your Agent Code</a>
            </div>
        
            <div class="small-link mt-3">
                <a href="{% url 'kyc:admin_login' %}" style="font-weight:700;color:#0a1d56;">
                    Admin Login
                </a>
            </div>
        </form>


    </div>
</div>

<!-- POPUP -->
<div id="popup" class="popup-overlay">
    <div class="popup-box">
        <div id="popupIcon"></div>
        <div id="popupTitle" class="popup-title"></div>
        <div id="popupMsg" class="popup-msg"></div>
        <button id="popupOk" class="popup-ok btn-green">OK</button>
    </div>
</div>

<script>
// Selectors
const tabPolicy=document.getElementById("tabPolicy");
const tabAgent=document.getElementById("tabAgent");

const policyForm=document.getElementById("policyForm");
const agentForm=document.getElementById("agentForm");

// TAB SWITCH LOGIC
tabPolicy.onclick=()=>{
    tabPolicy.classList.add("active");
    tabAgent.classList.remove("active");
    policyForm.style.display="block";
    agentForm.style.display="none";
};

tabAgent.onclick=()=>{
    tabAgent.classList.add("active");
    tabPolicy.classList.remove("active");
    agentForm.style.display="block";
    policyForm.style.display="none";
};

// AUTO-SELECT TAB FROM BACKEND
{% if active_tab == "agent" %} tabAgent.click(); {% endif %}

// POPUP LOGIC
const popup=document.getElementById("popup");
const popupIcon=document.getElementById("popupIcon");
const popupTitle=document.getElementById("popupTitle");
const popupMsg=document.getElementById("popupMsg");
const popupOk=document.getElementById("popupOk");

const m=document.querySelector(".js-msg");
if(m){
    popup.style.display="flex";
    popupMsg.textContent=m.dataset.text;

    if(m.dataset.tags.includes("success")){
        popupTitle.textContent="Success";
        popupIcon.innerHTML=`<i class="bi bi-check-circle-fill" style="font-size:32px;color:#16a34a"></i>`;
        popupOk.onclick=()=>window.location.reload();
    } else {
        popupTitle.textContent="Error";
        popupIcon.innerHTML=`<i class="bi bi-x-circle-fill" style="font-size:32px;color:#dc3545"></i>`;
        popupOk.onclick=()=>popup.style.display="none";
    }
}
</script>

</body>
</html>
